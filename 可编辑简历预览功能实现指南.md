# 可编辑简历预览功能 - 实现指南

## 功能概述

实现了一个**可编辑的简历预览组件**，允许用户：
1. ✅ 查看完整的简历内容（分章节显示）
2. ✅ AI 高亮提示可优化的部分
3. ✅ 人工编辑每个章节
4. ✅ 查看和应用 AI 建议
5. ✅ 保存修改后的内容

## 核心特性

### 1. 完整简历展示
- 按照工作经历、项目经验、技能等分章节显示
- 每个章节独立展示，清晰易读
- 支持滚动查看长内容

### 2. AI 智能提示
- 有 AI 建议的章节会有特殊标记（橙色边框 + "AI 建议" 标签）
- 点击"查看 AI 建议"可以对比当前内容和 AI 优化建议
- 一键应用 AI 建议

### 3. 灵活编辑
- 每个章节都有"编辑"按钮
- 点击编辑后进入编辑模式，显示文本框
- 支持保存或取消编辑
- 修改后自动标记为"有变更"

### 4. 混合优化
- **AI 优化**：应用 AI 建议快速改进
- **人工精调**：手动编辑细节内容
- **灵活组合**：先用 AI 优化，再人工调整

## 文件结构

```
frontend/src/components/
├── EditableResumePreview.tsx    # 主组件
└── EditableResumePreview.css    # 样式文件
```

## 组件 API

### Props

```typescript
interface EditableResumePreviewProps {
    resumeData: any;              // 简历数据
    suggestions?: any;            // AI 建议数据
    onSave?: (updatedData: any) => void;  // 保存回调
}
```

### 使用示例

```tsx
import EditableResumePreview from '@/components/EditableResumePreview';

function MyPage() {
    const [resumeData, setResumeData] = useState(null);
    const [suggestions, setSuggestions] = useState(null);

    const handleSave = (updatedData) => {
        console.log('保存的数据:', updatedData);
        // 调用 API 保存到后端
    };

    return (
        <EditableResumePreview
            resumeData={resumeData}
            suggestions={suggestions}
            onSave={handleSave}
        />
    );
}
```

## 集成到 MatchAnalysis 页面

### 步骤 1：导入组件

在 `frontend/src/pages/match/MatchAnalysis.tsx` 中：

```tsx
import EditableResumePreview from '@/components/EditableResumePreview';
```

### 步骤 2：替换现有预览

找到"改写方案预览"部分（大约第 405-411 行），替换为：

```tsx
<Card 
    title={<><FileTextOutlined style={{ color: '#1890ff', marginRight: 8 }} />完整简历预览与编辑</>}
    className="preview-card"
>
    {result?.optimized_resume ? (
        <EditableResumePreview
            resumeData={parseResumeData(result.optimized_resume)}
            suggestions={result.suggestions}
            onSave={handleSaveResume}
        />
    ) : (
        <Empty
            description="暂无完整简历预览，请查看上方的优化建议"
            image={Empty.PRESENTED_IMAGE_SIMPLE}
        />
    )}
</Card>
```

### 步骤 3：添加辅助函数

```tsx
// 解析简历数据
const parseResumeData = (resumeText: string) => {
    // 如果 optimized_resume 是 JSON 字符串，解析它
    try {
        return JSON.parse(resumeText);
    } catch {
        // 如果是纯文本，返回一个基本结构
        return {
            work_experience: [],
            project_experience: [],
            skills_sections: []
        };
    }
};

// 保存简历修改
const handleSaveResume = async (updatedData: any) => {
    try {
        // 调用后端 API 保存修改
        await axios.post(`${baseUrl}/resume/save`, {
            resume_id: selectedResume,
            data: updatedData
        });
        message.success('简历修改已保存');
    } catch (error) {
        message.error('保存失败，请重试');
    }
};
```

## 数据结构

### 输入数据格式（resumeData）

```json
{
    "work_experience": [
        {
            "company": "公司名称",
            "position": "职位",
            "duration": "2020.01 - 2022.12",
            "description": "职责描述",
            "achievements": [
                "成就1",
                "成就2"
            ]
        }
    ],
    "project_experience": [
        {
            "name": "项目名称",
            "role": "项目角色",
            "duration": "2021.01 - 2021.12",
            "description": "项目描述",
            "actions": [
                "行动1",
                "行动2"
            ],
            "results": "项目成果"
        }
    ],
    "skills_sections": [
        {
            "category": "技术栈",
            "skills": ["Java", "Python", "React"]
        }
    ]
}
```

### AI 建议数据格式（suggestions）

```json
{
    "work": [
        {
            "index": 0,
            "suggestion": "建议优化的内容..."
        }
    ],
    "project": [
        {
            "index": 0,
            "suggestion": "建议优化的内容..."
        }
    ]
}
```

## 功能演示

### 1. 查看完整简历
```
┌─────────────────────────────────────┐
│  💡 可编辑简历预览                   │
│  [AI 辅助] [人工编辑]  [保存所有修改]│
├─────────────────────────────────────┤
│  ┌───────────────────────────────┐  │
│  │ 高级安全工程师 @ 奇安信集团    │  │
│  │ [AI 建议] [查看 AI 建议] [编辑]│  │
│  ├───────────────────────────────┤  │
│  │ 职位：高级安全工程师           │  │
│  │ 公司：奇安信集团               │  │
│  │ 时间：2024.05-至今             │  │
│  │                               │  │
│  │ 描述：网络/信息安全...         │  │
│  │                               │  │
│  │ 成就：                        │  │
│  │ 1. 主导数据加密全架构设计...   │  │
│  │ 2. 包括数据分类分级...         │  │
│  └───────────────────────────────┘  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │ 项目：腾讯业务数据安全防护项目 │  │
│  │ [编辑]                        │  │
│  ├───────────────────────────────┤  │
│  │ ...                           │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

### 2. 编辑模式
```
┌─────────────────────────────────────┐
│  高级安全工程师 @ 奇安信集团         │
│  [保存] [取消]                      │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │ 职位：高级安全工程师         │   │
│  │ 公司：奇安信集团             │   │
│  │ 时间：2024.05-至今           │   │
│  │                             │   │
│  │ 描述：[可编辑文本框]         │   │
│  │                             │   │
│  │ 成就：                      │   │
│  │ 1. [可编辑]                 │   │
│  │ 2. [可编辑]                 │   │
│  └─────────────────────────────┘   │
└─────────────────────────────────────┘
```

### 3. AI 建议对话框
```
┌─────────────────────────────────────┐
│  AI 优化建议                         │
├─────────────────────────────────────┤
│  当前内容：                          │
│  ┌─────────────────────────────┐   │
│  │ 负责网络安全工作             │   │
│  └─────────────────────────────┘   │
│                                     │
│  AI 建议：                          │
│  ┌─────────────────────────────┐   │
│  │ 主导网络/信息安全架构设计，  │   │
│  │ 战略客户数据安全架构项目，   │   │
│  │ 包括数据分类分级、加密和访问 │   │
│  │ 控制等，跨域沟通协作...      │   │
│  └─────────────────────────────┘   │
│                                     │
│  [应用建议] [取消]                  │
└─────────────────────────────────────┘
```

## 样式特点

### 视觉设计
- **渐变头部**：紫色渐变背景，醒目美观
- **AI 标记**：橙色左边框 + 淡黄色背景
- **编辑高亮**：蓝色边框 + 淡蓝色背景
- **动画效果**：淡入动画 + 脉冲效果

### 交互反馈
- **悬停效果**：卡片阴影加深
- **编辑状态**：边框颜色变化
- **保存提示**：消息提示 + 按钮动画

## 优势对比

### 之前的方案
- ❌ 只显示纯文本
- ❌ 无法编辑
- ❌ AI 建议和内容分离
- ❌ 不够直观

### 现在的方案
- ✅ 结构化展示
- ✅ 每个章节可编辑
- ✅ AI 建议直接关联
- ✅ 所见即所得
- ✅ 灵活性强

## 后续优化建议

### 1. 富文本编辑
- 支持加粗、斜体、列表等格式
- 使用富文本编辑器（如 Quill、Draft.js）

### 2. 实时保存
- 自动保存草稿
- 防止意外丢失

### 3. 版本历史
- 记录每次修改
- 支持回退到历史版本

### 4. AI 智能建议
- 实时分析内容质量
- 提供更多优化建议

### 5. 协作功能
- 多人同时编辑
- 评论和批注

## 技术要点

### 状态管理
- 使用 `useState` 管理章节数据
- 使用 `useEffect` 监听数据变化
- 使用 `hasChanges` 标记是否有修改

### 数据转换
- `parseSections`：将简历数据转换为可编辑章节
- `formatWorkExperience`：格式化工作经历
- `formatProjectExperience`：格式化项目经验

### 用户体验
- 编辑前确认
- 保存后提示
- 取消时恢复原内容

## 总结

这个可编辑简历预览组件完美实现了您的需求：
- ✅ 查看完整简历
- ✅ AI 智能提示
- ✅ 人工灵活编辑
- ✅ 混合优化方式

它提供了**AI 辅助 + 人工精调**的完美结合，让简历优化更加高效和灵活！
