# AI 智能简历优化应用 - 技术架构文档

## 一、系统架构概览

### 1.1 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        用户层                                │
│                    (Web Browser)                            │
└─────────────────────────────────────────────────────────────┘
                            ↓ HTTPS
┌─────────────────────────────────────────────────────────────┐
│                      Nginx 反向代理                          │
│                  (负载均衡 + SSL 终止)                       │
└─────────────────────────────────────────────────────────────┘
                            ↓
        ┌──────────────────┴──────────────────┐
        ↓                                      ↓
┌──────────────────┐                  ┌──────────────────┐
│   前端应用层      │                  │   后端应用层      │
│  React + TS      │                  │    FastAPI       │
│  (Vite 构建)     │←────HTTP/WS─────→│   (Uvicorn)      │
└──────────────────┘                  └──────────────────┘
                                              ↓
                        ┌─────────────────────┼─────────────────────┐
                        ↓                     ↓                     ↓
              ┌──────────────┐      ┌──────────────┐      ┌──────────────┐
              │ PostgreSQL   │      │    Redis     │      │  文件存储     │
              │  (主数据库)   │      │  (缓存/队列)  │      │  (本地/OSS)   │
              └──────────────┘      └──────────────┘      └──────────────┘
                                              ↓
                                    ┌──────────────┐
                                    │    Celery    │
                                    │  (异步任务)   │
                                    └──────────────┘
                                              ↓
                                    ┌──────────────┐
                                    │  AI 服务层    │
                                    │ OpenAI API   │
                                    └──────────────┘
```

### 1.2 技术栈总览

| 层次 | 技术选型 | 说明 |
|------|---------|------|
| **前端** | React 18 + TypeScript | 现代化前端框架 |
| **构建工具** | Vite | 快速的开发构建工具 |
| **状态管理** | Zustand | 轻量级状态管理 |
| **UI 组件** | Ant Design 5 | 企业级 UI 组件库 |
| **路由** | React Router v6 | 前端路由管理 |
| **HTTP 客户端** | Axios | HTTP 请求库 |
| **后端框架** | FastAPI | 高性能 Python Web 框架 |
| **Web 服务器** | Uvicorn | ASGI 服务器 |
| **ORM** | SQLAlchemy 2.0 | Python ORM 框架 |
| **数据验证** | Pydantic v2 | 数据验证和序列化 |
| **数据库** | PostgreSQL 15+ | 关系型数据库 |
| **缓存** | Redis 7+ | 内存数据库 |
| **任务队列** | Celery | 分布式任务队列 |
| **AI 服务** | OpenAI API | GPT-4 / Claude |
| **文档解析** | pdfplumber, python-docx | PDF/Word 解析 |
| **认证** | JWT | Token 认证 |
| **容器化** | Docker + Docker Compose | 容器化部署 |
| **反向代理** | Nginx | Web 服务器 |

---

## 二、前端架构设计

### 2.1 前端分层架构

```
┌─────────────────────────────────────┐
│         展示层 (Pages)               │
│  - 页面组件                          │
│  - 路由配置                          │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│       组件层 (Components)            │
│  - 业务组件                          │
│  - 通用组件                          │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│       逻辑层 (Hooks + Stores)        │
│  - 自定义 Hooks                      │
│  - 状态管理                          │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│       服务层 (Services)              │
│  - API 调用                          │
│  - 数据转换                          │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│       工具层 (Utils)                 │
│  - 通用工具函数                      │
│  - 常量定义                          │
└─────────────────────────────────────┘
```

### 2.2 前端目录结构

```
frontend/
├── public/                      # 静态资源
│   ├── favicon.ico
│   └── logo.png
├── src/
│   ├── assets/                  # 资源文件
│   │   ├── images/
│   │   ├── fonts/
│   │   └── styles/
│   │       ├── global.css       # 全局样式
│   │       ├── variables.css    # CSS 变量
│   │       └── reset.css        # 样式重置
│   │
│   ├── components/              # 组件
│   │   ├── common/              # 通用组件
│   │   │   ├── Button/
│   │   │   ├── Input/
│   │   │   ├── Modal/
│   │   │   ├── Loading/
│   │   │   └── Upload/
│   │   ├── layout/              # 布局组件
│   │   │   ├── Header/
│   │   │   ├── Sidebar/
│   │   │   ├── Footer/
│   │   │   └── MainLayout/
│   │   ├── resume/              # 简历相关组件
│   │   │   ├── ResumeCard/
│   │   │   ├── ResumeForm/
│   │   │   ├── ResumePreview/
│   │   │   └── ResumeUpload/
│   │   ├── job/                 # 职位相关组件
│   │   │   ├── JobCard/
│   │   │   ├── JobForm/
│   │   │   └── JobList/
│   │   ├── match/               # 匹配相关组件
│   │   │   ├── MatchReport/
│   │   │   ├── MatchRadar/
│   │   │   └── MatchScore/
│   │   └── optimize/            # 优化相关组件
│   │       ├── OptimizeSuggestions/
│   │       ├── OptimizeComparison/
│   │       └── OptimizePreview/
│   │
│   ├── pages/                   # 页面组件
│   │   ├── auth/
│   │   │   ├── Login.tsx
│   │   │   └── Register.tsx
│   │   ├── resume/
│   │   │   ├── ResumeList.tsx
│   │   │   ├── ResumeDetail.tsx
│   │   │   └── ResumeUpload.tsx
│   │   ├── job/
│   │   │   ├── JobList.tsx
│   │   │   ├── JobDetail.tsx
│   │   │   └── JobCreate.tsx
│   │   ├── match/
│   │   │   ├── MatchAnalysis.tsx
│   │   │   └── MatchHistory.tsx
│   │   ├── optimize/
│   │   │   ├── OptimizeResume.tsx
│   │   │   └── OptimizeResult.tsx
│   │   ├── Dashboard.tsx
│   │   └── NotFound.tsx
│   │
│   ├── hooks/                   # 自定义 Hooks
│   │   ├── useAuth.ts           # 认证相关
│   │   ├── useResume.ts         # 简历操作
│   │   ├── useJob.ts            # 职位操作
│   │   ├── useMatch.ts          # 匹配分析
│   │   ├── useOptimize.ts       # 简历优化
│   │   └── useUpload.ts         # 文件上传
│   │
│   ├── stores/                  # 状态管理
│   │   ├── authStore.ts         # 用户认证状态
│   │   ├── resumeStore.ts       # 简历状态
│   │   ├── jobStore.ts          # 职位状态
│   │   └── uiStore.ts           # UI 状态
│   │
│   ├── services/                # API 服务
│   │   ├── api.ts               # Axios 实例配置
│   │   ├── authService.ts       # 认证 API
│   │   ├── resumeService.ts     # 简历 API
│   │   ├── jobService.ts        # 职位 API
│   │   ├── matchService.ts      # 匹配 API
│   │   └── optimizeService.ts   # 优化 API
│   │
│   ├── types/                   # TypeScript 类型
│   │   ├── user.ts
│   │   ├── resume.ts
│   │   ├── job.ts
│   │   ├── match.ts
│   │   └── api.ts
│   │
│   ├── utils/                   # 工具函数
│   │   ├── format.ts            # 格式化函数
│   │   ├── validate.ts          # 验证函数
│   │   ├── storage.ts           # 本地存储
│   │   └── constants.ts         # 常量定义
│   │
│   ├── router/                  # 路由配置
│   │   ├── index.tsx
│   │   └── routes.tsx
│   │
│   ├── App.tsx                  # 根组件
│   ├── main.tsx                 # 入口文件
│   └── vite-env.d.ts
│
├── .env.development             # 开发环境变量
├── .env.production              # 生产环境变量
├── .eslintrc.json               # ESLint 配置
├── .prettierrc                  # Prettier 配置
├── tsconfig.json                # TypeScript 配置
├── vite.config.ts               # Vite 配置
├── package.json
└── README.md
```

### 2.3 核心技术实现

#### 2.3.1 路由配置
```typescript
// router/routes.tsx
import { lazy } from 'react'
import { RouteObject } from 'react-router-dom'

const Login = lazy(() => import('@/pages/auth/Login'))
const Dashboard = lazy(() => import('@/pages/Dashboard'))
const ResumeList = lazy(() => import('@/pages/resume/ResumeList'))

export const routes: RouteObject[] = [
  {
    path: '/login',
    element: <Login />
  },
  {
    path: '/',
    element: <MainLayout />,
    children: [
      { index: true, element: <Dashboard /> },
      { path: 'resumes', element: <ResumeList /> },
      // ... 其他路由
    ]
  }
]
```

#### 2.3.2 状态管理（Zustand）
```typescript
// stores/authStore.ts
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

interface AuthState {
  user: User | null
  token: string | null
  isAuthenticated: boolean
  login: (email: string, password: string) => Promise<void>
  logout: () => void
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      isAuthenticated: false,
      login: async (email, password) => {
        // 登录逻辑
      },
      logout: () => {
        set({ user: null, token: null, isAuthenticated: false })
      }
    }),
    { name: 'auth-storage' }
  )
)
```

#### 2.3.3 API 服务封装
```typescript
// services/api.ts
import axios from 'axios'
import { useAuthStore } from '@/stores/authStore'

const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000
})

// 请求拦截器
api.interceptors.request.use((config) => {
  const token = useAuthStore.getState().token
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// 响应拦截器
api.interceptors.response.use(
  (response) => response.data,
  (error) => {
    // 错误处理
    return Promise.reject(error)
  }
)

export default api
```

---

## 三、后端架构设计

### 3.1 后端分层架构

```
┌─────────────────────────────────────┐
│         API 层 (Router)              │
│  - 请求解析                          │
│  - 参数验证                          │
│  - 响应封装                          │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│       业务逻辑层 (Service)           │
│  - 业务规则                          │
│  - 数据处理                          │
│  - 第三方集成                        │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│       数据访问层 (Repository)        │
│  - 数据库操作                        │
│  - 缓存操作                          │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│         数据层 (Model)               │
│  - ORM 模型                          │
│  - 数据验证                          │
└─────────────────────────────────────┘
```

### 3.2 后端目录结构

```
backend/
├── app/
│   ├── api/                     # API 路由层
│   │   ├── deps.py              # 依赖注入
│   │   └── v1/                  # API v1 版本
│   │       ├── __init__.py
│   │       ├── auth.py          # 认证接口
│   │       ├── resume.py        # 简历接口
│   │       ├── job.py           # 职位接口
│   │       ├── match.py         # 匹配接口
│   │       └── optimize.py      # 优化接口
│   │
│   ├── core/                    # 核心配置
│   │   ├── __init__.py
│   │   ├── config.py            # 配置管理
│   │   ├── security.py          # 安全相关
│   │   ├── logging.py           # 日志配置
│   │   └── database.py          # 数据库连接
│   │
│   ├── models/                  # 数据库模型
│   │   ├── __init__.py
│   │   ├── base.py              # 基础模型
│   │   ├── user.py              # 用户模型
│   │   ├── resume.py            # 简历模型
│   │   ├── job.py               # 职位模型
│   │   ├── match.py             # 匹配模型
│   │   └── optimized_resume.py  # 优化简历模型
│   │
│   ├── schemas/                 # Pydantic 模型
│   │   ├── __init__.py
│   │   ├── user.py              # 用户 Schema
│   │   ├── resume.py            # 简历 Schema
│   │   ├── job.py               # 职位 Schema
│   │   ├── match.py             # 匹配 Schema
│   │   └── common.py            # 通用 Schema
│   │
│   ├── services/                # 业务逻辑层
│   │   ├── __init__.py
│   │   ├── auth_service.py      # 认证服务
│   │   ├── resume_service.py    # 简历服务
│   │   ├── job_service.py       # 职位服务
│   │   ├── match_service.py     # 匹配服务
│   │   ├── optimize_service.py  # 优化服务
│   │   ├── ai_service.py        # AI 服务
│   │   └── file_service.py      # 文件服务
│   │
│   ├── repository/              # 数据访问层
│   │   ├── __init__.py
│   │   ├── base.py              # 基础仓储
│   │   ├── user_repo.py         # 用户仓储
│   │   ├── resume_repo.py       # 简历仓储
│   │   ├── job_repo.py          # 职位仓储
│   │   └── match_repo.py        # 匹配仓储
│   │
│   ├── utils/                   # 工具函数
│   │   ├── __init__.py
│   │   ├── parser.py            # 文档解析
│   │   ├── ai_helper.py         # AI 辅助函数
│   │   ├── export.py            # 导出功能
│   │   └── validators.py        # 验证器
│   │
│   ├── tasks/                   # Celery 任务
│   │   ├── __init__.py
│   │   ├── resume_tasks.py      # 简历相关任务
│   │   └── match_tasks.py       # 匹配相关任务
│   │
│   └── main.py                  # 应用入口
│
├── tests/                       # 测试
│   ├── __init__.py
│   ├── conftest.py              # pytest 配置
│   ├── test_auth.py
│   ├── test_resume.py
│   └── test_match.py
│
├── alembic/                     # 数据库迁移
│   ├── versions/
│   ├── env.py
│   └── alembic.ini
│
├── uploads/                     # 上传文件目录
│   ├── resumes/
│   └── temp/
│
├── logs/                        # 日志目录
│
├── .env                         # 环境变量
├── .env.example                 # 环境变量示例
├── requirements.txt             # 依赖列表
├── requirements-dev.txt         # 开发依赖
├── Dockerfile                   # Docker 配置
├── docker-compose.yml           # Docker Compose
├── pytest.ini                   # pytest 配置
└── README.md
```

### 3.3 核心技术实现

#### 3.3.1 FastAPI 应用配置
```python
# app/main.py
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from app.core.config import settings
from app.api.v1 import auth, resume, job, match, optimize

app = FastAPI(
    title=settings.PROJECT_NAME,
    version=settings.VERSION,
    openapi_url=f"{settings.API_V1_STR}/openapi.json"
)

# CORS 配置
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.ALLOWED_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# 注册路由
app.include_router(auth.router, prefix=f"{settings.API_V1_STR}/auth", tags=["auth"])
app.include_router(resume.router, prefix=f"{settings.API_V1_STR}/resumes", tags=["resumes"])
app.include_router(job.router, prefix=f"{settings.API_V1_STR}/jobs", tags=["jobs"])
app.include_router(match.router, prefix=f"{settings.API_V1_STR}/match", tags=["match"])
app.include_router(optimize.router, prefix=f"{settings.API_V1_STR}/optimize", tags=["optimize"])
```

#### 3.3.2 配置管理
```python
# app/core/config.py
from pydantic_settings import BaseSettings
from typing import List
import os

class Settings(BaseSettings):
    # 项目信息
    PROJECT_NAME: str = "AI 智能简历优化应用"
    VERSION: str = "1.0.0"
    API_V1_STR: str = "/api/v1"
    
    # 安全配置
    SECRET_KEY: str = os.getenv("SECRET_KEY")
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 60 * 24 * 7  # 7 天
    
    # 数据库配置
    DATABASE_URL: str = os.getenv("DATABASE_URL")
    
    # Redis 配置
    REDIS_URL: str = os.getenv("REDIS_URL", "redis://localhost:6379/0")
    
    # AI 配置
    OPENAI_API_KEY: str = os.getenv("OPENAI_API_KEY")
    OPENAI_MODEL: str = "gpt-4"
    
    # CORS 配置
    ALLOWED_ORIGINS: List[str] = ["http://localhost:5173", "http://localhost:3000"]
    
    # 文件上传配置
    UPLOAD_DIR: str = "uploads"
    MAX_UPLOAD_SIZE: int = 10 * 1024 * 1024  # 10MB
    
    class Config:
        env_file = ".env"

settings = Settings()
```

#### 3.3.3 数据库模型示例
```python
# app/models/resume.py
from sqlalchemy import Column, String, Boolean, ForeignKey, Text
from sqlalchemy.dialects.postgresql import UUID, JSONB
from sqlalchemy.orm import relationship
import uuid
from app.models.base import BaseModel

class Resume(BaseModel):
    __tablename__ = "resumes"
    
    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id", ondelete="CASCADE"))
    title = Column(String(100), nullable=False)
    file_path = Column(String(255))
    file_type = Column(String(20))
    parsed_data = Column(JSONB)  # 解析后的结构化数据
    is_default = Column(Boolean, default=False)
    
    # 关系
    user = relationship("User", back_populates="resumes")
    match_records = relationship("MatchRecord", back_populates="resume")
```

#### 3.3.4 Service 层示例
```python
# app/services/resume_service.py
from typing import List, Optional
from uuid import UUID
from app.repository.resume_repo import ResumeRepository
from app.schemas.resume import ResumeCreate, ResumeUpdate
from app.models.resume import Resume
from app.utils.parser import parse_resume_file
from app.services.ai_service import AIService

class ResumeService:
    def __init__(self):
        self.repo = ResumeRepository()
        self.ai_service = AIService()
    
    async def create_resume(
        self, 
        user_id: UUID, 
        file_path: str, 
        file_type: str
    ) -> Resume:
        """
        创建简历并解析
        """
        # 1. 提取文本
        text = await parse_resume_file(file_path, file_type)
        
        # 2. AI 解析结构化数据
        parsed_data = await self.ai_service.parse_resume(text)
        
        # 3. 保存到数据库
        resume_data = ResumeCreate(
            user_id=user_id,
            title=parsed_data.get("basic_info", {}).get("name", "未命名简历"),
            file_path=file_path,
            file_type=file_type,
            parsed_data=parsed_data
        )
        
        return await self.repo.create(resume_data)
    
    async def get_user_resumes(self, user_id: UUID) -> List[Resume]:
        """
        获取用户的所有简历
        """
        return await self.repo.get_by_user_id(user_id)
```

---

## 四、数据库设计

### 4.1 ER 图

```
┌─────────────┐
│    Users    │
├─────────────┤
│ id (PK)     │
│ username    │
│ email       │
│ password    │
└─────────────┘
       │
       │ 1:N
       ↓
┌─────────────┐         ┌──────────────────┐
│   Resumes   │────────→│ OptimizedResumes │
├─────────────┤   1:N   ├──────────────────┤
│ id (PK)     │         │ id (PK)          │
│ user_id(FK) │         │ original_id (FK) │
│ title       │         │ job_id (FK)      │
│ file_path   │         │ optimized_data   │
│ parsed_data │         └──────────────────┘
└─────────────┘
       │
       │ 1:N
       ↓
┌──────────────┐
│ MatchRecords │
├──────────────┤
│ id (PK)      │
│ resume_id(FK)│←──┐
│ job_id (FK)  │   │
│ match_score  │   │
│ match_detail │   │
└──────────────┘   │
       ↑           │
       │ N:1       │
       │           │
┌─────────────┐   │
│JobPositions │───┘
├─────────────┤
│ id (PK)     │
│ user_id(FK) │
│ title       │
│ company     │
│ requirements│
└─────────────┘
```

### 4.2 索引策略

```sql
-- 用户相关索引
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);

-- 简历相关索引
CREATE INDEX idx_resumes_user_id ON resumes(user_id);
CREATE INDEX idx_resumes_created_at ON resumes(created_at DESC);
CREATE INDEX idx_resumes_is_default ON resumes(user_id, is_default) WHERE is_default = true;

-- 职位相关索引
CREATE INDEX idx_jobs_user_id ON job_positions(user_id);
CREATE INDEX idx_jobs_created_at ON job_positions(created_at DESC);

-- 匹配记录索引
CREATE INDEX idx_match_resume_job ON match_records(resume_id, job_id);
CREATE INDEX idx_match_score ON match_records(match_score DESC);

-- JSONB 字段索引（用于查询）
CREATE INDEX idx_resumes_parsed_data_gin ON resumes USING gin(parsed_data);
CREATE INDEX idx_jobs_requirements_gin ON job_positions USING gin(requirements);
```

---

## 五、AI 服务设计

### 5.1 AI 服务架构

```python
# app/services/ai_service.py
from openai import AsyncOpenAI
from app.core.config import settings
import json

class AIService:
    def __init__(self):
        self.client = AsyncOpenAI(api_key=settings.OPENAI_API_KEY)
    
    async def parse_resume(self, resume_text: str) -> dict:
        """
        解析简历文本，提取结构化信息
        """
        prompt = f"""
你是一个专业的简历解析助手。请从以下简历文本中提取结构化信息：

【简历文本】
{resume_text}

请按以下 JSON 格式输出：
{{
  "basic_info": {{
    "name": "",
    "phone": "",
    "email": "",
    "location": ""
  }},
  "education": [
    {{
      "school": "",
      "major": "",
      "degree": "",
      "start_date": "",
      "end_date": ""
    }}
  ],
  "work_experience": [
    {{
      "company": "",
      "position": "",
      "start_date": "",
      "end_date": "",
      "responsibilities": []
    }}
  ],
  "projects": [
    {{
      "name": "",
      "role": "",
      "tech_stack": [],
      "description": "",
      "achievements": []
    }}
  ],
  "skills": []
}}
"""
        
        response = await self.client.chat.completions.create(
            model=settings.OPENAI_MODEL,
            messages=[
                {"role": "system", "content": "你是一个专业的简历解析助手。"},
                {"role": "user", "content": prompt}
            ],
            temperature=0.1,
            response_format={"type": "json_object"}
        )
        
        return json.loads(response.choices[0].message.content)
    
    async def analyze_job_requirements(self, job_description: str) -> dict:
        """
        分析职位需求
        """
        # 类似的实现...
        pass
    
    async def calculate_match(self, resume_data: dict, job_requirements: dict) -> dict:
        """
        计算匹配度
        """
        # 类似的实现...
        pass
    
    async def optimize_resume(
        self, 
        resume_data: dict, 
        job_requirements: dict
    ) -> dict:
        """
        优化简历
        """
        # 类似的实现...
        pass
```

---

## 六、部署架构

### 6.1 Docker Compose 配置

```yaml
# docker-compose.yml
version: '3.8'

services:
  # PostgreSQL 数据库
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: ai_resume
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis 缓存
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  # 后端 API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      DATABASE_URL: postgresql://postgres:${DB_PASSWORD}@postgres:5432/ai_resume
      REDIS_URL: redis://redis:6379/0
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      SECRET_KEY: ${SECRET_KEY}
    volumes:
      - ./backend:/app
      - uploads:/app/uploads
    ports:
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  # Celery Worker
  celery:
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      DATABASE_URL: postgresql://postgres:${DB_PASSWORD}@postgres:5432/ai_resume
      REDIS_URL: redis://redis:6379/0
      OPENAI_API_KEY: ${OPENAI_API_KEY}
    volumes:
      - ./backend:/app
      - uploads:/app/uploads
    depends_on:
      - postgres
      - redis
    command: celery -A app.tasks worker --loglevel=info

  # 前端
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "5173:5173"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      VITE_API_BASE_URL: http://localhost:8000/api/v1
    command: npm run dev -- --host

  # Nginx 反向代理
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
    depends_on:
      - backend
      - frontend

volumes:
  postgres_data:
  redis_data:
  uploads:
```

---

## 七、安全设计

### 7.1 认证与授权

- **JWT Token 认证**
- **密码加密存储**（bcrypt）
- **Token 刷新机制**
- **权限验证中间件**

### 7.2 数据安全

- **HTTPS 加密传输**
- **敏感数据加密存储**
- **文件上传安全检查**
- **SQL 注入防护**
- **XSS/CSRF 防护**

### 7.3 API 安全

- **请求限流**
- **参数验证**
- **错误信息脱敏**
- **操作日志记录**

---

**文档版本**：v1.0  
**创建日期**：2026-02-05  
**最后更新**：2026-02-05
