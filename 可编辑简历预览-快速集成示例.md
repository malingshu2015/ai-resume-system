# 快速集成示例

## 在 MatchAnalysis.tsx 中集成可编辑简历预览

### 1. 导入组件（文件顶部）

```tsx
// 在其他 import 语句后添加
import EditableResumePreview from '@/components/EditableResumePreview';
```

### 2. 添加状态管理（在组件内部）

```tsx
// 在现有的 useState 后添加
const [editedResumeData, setEditedResumeData] = useState<any>(null);
```

### 3. 添加辅助函数

```tsx
// 解析简历数据
const parseResumeData = (resumeText: string) => {
    // 如果 optimized_resume 已经是对象，直接返回
    if (typeof resumeText === 'object') {
        return resumeText;
    }
    
    // 如果是 JSON 字符串，解析它
    try {
        return JSON.parse(resumeText);
    } catch {
        // 如果解析失败，返回空结构
        console.warn('无法解析简历数据，返回空结构');
        return {
            work_experience: [],
            project_experience: [],
            skills_sections: []
        };
    }
};

// 保存简历修改
const handleSaveResume = async (updatedData: any) => {
    try {
        setEditedResumeData(updatedData);
        
        // 可选：调用后端 API 保存修改
        // await axios.post(`${baseUrl}/resume/save`, {
        //     resume_id: selectedResume,
        //     data: updatedData
        // });
        
        message.success('简历修改已保存');
    } catch (error) {
        message.error('保存失败，请重试');
        console.error('保存简历失败:', error);
    }
};
```

### 4. 替换现有的预览区域

找到"改写方案预览"部分（大约第 405-411 行），替换为：

**替换前：**
```tsx
<Card className="optimized-preview-card" title="改写方案预览">
    <div className="optimized-content-scroll">
        <pre className="resume-pre">
            {renderTaggedText(result.optimized_resume || '未生成完整简历，请参考下方优化总结。')}
        </pre>
    </div>
</Card>
```

**替换后：**
```tsx
<Card 
    title={
        <>
            <FileTextOutlined style={{ color: '#1890ff', marginRight: 8 }} />
            完整简历预览与编辑
        </>
    }
    className="preview-card"
>
    {result?.optimized_resume ? (
        <EditableResumePreview
            resumeData={parseResumeData(result.optimized_resume)}
            suggestions={result.suggestions}
            onSave={handleSaveResume}
        />
    ) : (
        <Empty
            description="暂无完整简历预览，请先生成简历"
            image={Empty.PRESENTED_IMAGE_SIMPLE}
        />
    )}
</Card>
```

### 5. 完整的代码片段

```tsx
// MatchAnalysis.tsx 中的相关部分

import React, { useState, useEffect } from 'react';
import { Card, Button, message, Empty, Space, Tag, Alert } from 'antd';
import { FileTextOutlined, StarOutlined, CheckCircleOutlined } from '@ant-design/icons';
import EditableResumePreview from '@/components/EditableResumePreview';
import './MatchAnalysis.css';

const MatchAnalysis: React.FC = () => {
    // ... 其他状态
    const [editedResumeData, setEditedResumeData] = useState<any>(null);

    // 解析简历数据
    const parseResumeData = (resumeText: string) => {
        if (typeof resumeText === 'object') {
            return resumeText;
        }
        
        try {
            return JSON.parse(resumeText);
        } catch {
            console.warn('无法解析简历数据');
            return {
                work_experience: [],
                project_experience: [],
                skills_sections: []
            };
        }
    };

    // 保存简历修改
    const handleSaveResume = async (updatedData: any) => {
        try {
            setEditedResumeData(updatedData);
            message.success('简历修改已保存');
        } catch (error) {
            message.error('保存失败，请重试');
        }
    };

    return (
        <div className="match-analysis-container">
            {/* ... 其他内容 */}

            {result && (
                <div className="analysis-result-area">
                    <Tabs
                        items={[
                            // ... 其他 Tab
                            {
                                key: 'optimize',
                                label: '优化简历预览',
                                children: (
                                    <div className="optimize-tab">
                                        <Alert
                                            message="优化说明"
                                            description={
                                                <span>
                                                    以下是基于职位要求生成的简历优化方案。
                                                    您可以查看 AI 建议，也可以直接编辑每个部分。
                                                </span>
                                            }
                                            type="info"
                                            showIcon
                                            style={{ marginBottom: 20 }}
                                        />

                                        {/* 优化后的个人优势总结 */}
                                        <Card
                                            title={
                                                <>
                                                    <StarOutlined style={{ color: '#faad14', marginRight: 8 }} />
                                                    针对性个人优势
                                                </>
                                            }
                                            style={{ marginBottom: 16 }}
                                            className="summary-card"
                                        >
                                            <div className="summary-box">
                                                {renderTaggedText(result.optimized_summary)}
                                            </div>
                                        </Card>

                                        {/* 可编辑的简历预览 */}
                                        <Card 
                                            title={
                                                <>
                                                    <FileTextOutlined style={{ color: '#1890ff', marginRight: 8 }} />
                                                    完整简历预览与编辑
                                                </>
                                            }
                                            className="preview-card"
                                        >
                                            {result.optimized_resume ? (
                                                <EditableResumePreview
                                                    resumeData={parseResumeData(result.optimized_resume)}
                                                    suggestions={result.suggestions}
                                                    onSave={handleSaveResume}
                                                />
                                            ) : (
                                                <Empty
                                                    description="暂无完整简历预览，请先生成简历"
                                                    image={Empty.PRESENTED_IMAGE_SIMPLE}
                                                />
                                            )}
                                        </Card>

                                        {/* 操作按钮 */}
                                        <div style={{ textAlign: 'center', marginTop: 24 }}>
                                            <Button
                                                type="primary"
                                                size="large"
                                                icon={<CheckCircleOutlined />}
                                                onClick={() => setIsGeneratorOpen(true)}
                                                style={{ minWidth: 200 }}
                                            >
                                                应用优化并生成简历
                                            </Button>
                                        </div>
                                    </div>
                                )
                            }
                        ]}
                    />
                </div>
            )}
        </div>
    );
};

export default MatchAnalysis;
```

## 测试步骤

1. **启动开发服务器**
   ```bash
   cd frontend
   npm run dev
   ```

2. **访问匹配分析页面**
   - 打开浏览器访问 `http://localhost:5173`
   - 进入"匹配分析"页面

3. **执行匹配分析**
   - 选择简历和职位
   - 点击"开始匹配分析"
   - 等待分析完成

4. **查看可编辑预览**
   - 切换到"优化简历预览" Tab
   - 查看完整简历预览
   - 尝试编辑某个章节
   - 查看 AI 建议（如果有）
   - 保存修改

## 预期效果

### 功能验证清单

- [ ] 能够看到完整的简历内容（分章节显示）
- [ ] 每个章节都有"编辑"按钮
- [ ] 点击编辑后可以修改内容
- [ ] 保存后显示成功提示
- [ ] 取消编辑后恢复原内容
- [ ] 有 AI 建议的章节显示橙色标记
- [ ] 可以查看 AI 建议对话框
- [ ] 可以一键应用 AI 建议
- [ ] 修改后顶部显示"保存所有修改"按钮
- [ ] 点击"保存所有修改"后成功保存

## 常见问题

### Q1: 组件导入失败
**A:** 确保路径正确，可能需要使用相对路径：
```tsx
import EditableResumePreview from '../../components/EditableResumePreview';
```

### Q2: 简历数据格式不对
**A:** 检查后端返回的 `optimized_resume` 格式，确保是 JSON 对象或 JSON 字符串。

### Q3: AI 建议不显示
**A:** 检查 `suggestions` 数据结构，确保与组件期望的格式一致。

### Q4: 编辑后无法保存
**A:** 检查 `handleSaveResume` 函数是否正确实现，查看控制台错误信息。

## 下一步

1. **测试功能**：按照上述步骤测试所有功能
2. **调整样式**：根据实际效果微调 CSS
3. **完善逻辑**：根据实际数据结构调整解析逻辑
4. **添加后端**：实现保存到后端的 API 调用

## 总结

通过这个集成，您现在可以：
- ✅ 查看完整的结构化简历
- ✅ 看到 AI 的优化建议
- ✅ 人工编辑任何部分
- ✅ 灵活组合 AI 和人工优化

这正是您想要的"既可以通过 AI 的方式给它进行补充，也可以通过人工的方式再进行精细化的调整"！
