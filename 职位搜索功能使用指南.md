# 职位智能搜索功能 - 完整使用指南

## 📋 功能概述

职位智能搜索功能已全面升级，支持：
- ✅ **真实API对接**：集成 JSearch API（RapidAPI），获取全球真实职位数据
- ✅ **高级筛选**：薪资范围、经验要求等多维度筛选
- ✅ **批量导入**：一键批量导入职位到正式库
- ✅ **智能推荐**：基于简历自动推荐匹配职位
- ✅ **降级策略**：API不可用时自动使用模拟数据

---

## 🚀 快速开始

### 方案一：使用真实 API（推荐）

#### 1. 获取 JSearch API Key

1. 访问 [JSearch API on RapidAPI](https://rapidapi.com/letscrape-6bRBa3QguO5/api/jsearch)
2. 注册 RapidAPI 账号（免费）
3. 订阅 **BASIC 免费套餐**（每月 200 次请求，无需信用卡）
4. 复制 API Key

#### 2. 配置 API Key

```bash
cd backend
echo "JSEARCH_API_KEY=你的API_KEY" >> .env
```

#### 3. 测试 API 配置

```bash
cd backend
source venv/bin/activate
python test_jsearch_api.py
```

如果看到 "✅ 测试通过！" 说明配置成功。

#### 4. 启动服务

后端会自动检测 API Key 并使用真实数据。

### 方案二：使用模拟数据（无需配置）

如果不配置 API Key，系统会自动使用高质量的模拟数据，功能完全正常。

---

## 📖 API 接口文档

### 1. 创建搜索任务（支持高级筛选）

```bash
POST /api/v1/job-search/search
```

**请求体：**
```json
{
  "keyword": "Python Developer",
  "location": "Shenzhen, China",
  "max_results": 20,
  "salary_min": 20,        // 可选：最低薪资（k）
  "salary_max": 50,        // 可选：最高薪资（k）
  "experience_years": "3-5年"  // 可选：经验要求
}
```

**响应：**
```json
{
  "task_id": "xxx-xxx-xxx",
  "message": "搜索任务已创建，正在采集 Python Developer 相关职位（筛选条件：薪资20k-50k, 经验3-5年）..."
}
```

### 2. 批量导入职位

```bash
POST /api/v1/job-search/crawled-jobs/batch-import
```

**请求体：**
```json
{
  "job_ids": ["job-id-1", "job-id-2", "job-id-3"]
}
```

**响应：**
```json
{
  "message": "批量导入完成：成功 3 个，失败 0 个",
  "success_count": 3,
  "failed_count": 0,
  "total": 3
}
```

### 3. 智能推荐

```bash
GET /api/v1/job-search/recommend/{resume_id}?limit=10
```

**响应：**
```json
{
  "resume_id": "xxx",
  "total": 10,
  "recommendations": [
    {
      "id": "job-id",
      "title": "Python Developer",
      "company": "Google",
      "location": "San Francisco, CA",
      "salary_range": "$120k-$180k",
      "match_score": 85.5,
      "source_platform": "JSearch (Google for Jobs)",
      "created_at": "2026-02-07T06:00:00"
    }
  ]
}
```

---

## 🎯 使用示例

### 示例 1：搜索深圳的安全工程师（薪资 20-50k）

```bash
curl -X POST "http://localhost:8000/api/v1/job-search/search" \
  -H "Content-Type: application/json" \
  -d '{
    "keyword": "Security Engineer",
    "location": "Shenzhen, China",
    "max_results": 20,
    "salary_min": 20,
    "salary_max": 50,
    "experience_years": "3-5年"
  }'
```

### 示例 2：搜索远程 Python 开发职位

```bash
curl -X POST "http://localhost:8000/api/v1/job-search/search" \
  -H "Content-Type: application/json" \
  -d '{
    "keyword": "Python Developer",
    "location": "Remote",
    "max_results": 10
  }'
```

### 示例 3：批量导入职位

```bash
curl -X POST "http://localhost:8000/api/v1/job-search/crawled-jobs/batch-import" \
  -H "Content-Type: application/json" \
  -d '{
    "job_ids": ["job-id-1", "job-id-2", "job-id-3"]
  }'
```

### 示例 4：获取智能推荐

```bash
curl "http://localhost:8000/api/v1/job-search/recommend/resume-id-123?limit=10"
```

---

## 📊 JSearch API 数据来源

JSearch API 聚合了全球 40+ 个招聘平台的数据：

- Google for Jobs
- LinkedIn
- Indeed
- Glassdoor
- ZipRecruiter
- Monster
- CareerBuilder
- SimplyHired
- 等等...

---

## 💡 智能推荐算法

推荐系统基于多维度匹配评分（满分 100 分）：

1. **技能匹配（60分）**
   - 对比简历技能与职位要求
   - 计算技能重叠率

2. **经验匹配（30分）**
   - 对比工作年限与职位要求
   - 智能匹配经验区间

3. **关键词匹配（10分）**
   - 分析关键词相关性
   - 提升匹配精准度

---

## 🔧 高级配置

### 环境变量

在 `backend/.env` 中配置：

```bash
# JSearch API 配置
JSEARCH_API_KEY=your-rapidapi-key-here
```

### 免费套餐限制

- 每月 200 次请求
- 每次请求最多 10 个职位
- 支持多页查询（最多 20 页）

### 升级到付费套餐

如需更多请求次数：
- **PRO**: $9.99/月，1000 次请求
- **ULTRA**: $29.99/月，5000 次请求
- **MEGA**: $99.99/月，20000 次请求

---

## 🛡️ 降级策略

系统具备完善的降级机制：

1. **优先使用真实 API**：如果配置了 API Key
2. **自动降级**：API 调用失败时使用模拟数据
3. **无缝切换**：用户无感知，功能正常运行

---

## 📝 常见问题

### Q1: 如何知道当前使用的是真实数据还是模拟数据？

查看后端日志：
- 真实数据：`使用 JSearch API 获取真实职位数据`
- 模拟数据：`未配置 JSearch API Key，使用模拟数据`

### Q2: API 配额用完了怎么办？

系统会自动降级使用模拟数据，或者：
1. 等待下月配额重置
2. 升级到付费套餐

### Q3: 支持中国的招聘网站吗？

JSearch API 通过 Google for Jobs 聚合了部分中国职位，但数量有限。
建议：
- 使用英文关键词搜索
- 或继续使用模拟数据（包含国内公司）

### Q4: 如何对接国内招聘平台？

可以扩展 `job_search_service.py`，添加：
- Boss直聘 API
- 拉勾网 API
- 智联招聘 API
- 前程无忧 API

---

## 🎉 总结

职位智能搜索功能现已支持：
- ✅ 真实 API 对接（JSearch）
- ✅ 高级筛选（薪资、经验）
- ✅ 批量导入
- ✅ 智能推荐
- ✅ 自动降级

无论是否配置 API Key，系统都能正常运行！🚀
