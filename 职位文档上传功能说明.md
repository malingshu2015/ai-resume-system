# 职位文档上传功能说明

## 功能概述

在"录入新职位"页面新增了**文档上传解析**功能，用户现在可以通过上传 PDF 或 Word 文档来快速导入职位信息。

## 更新时间
2026-02-09

## 功能特性

### 1. 支持的文件格式
- **PDF 文档** (.pdf)
- **Word 文档** (.doc, .docx)

### 2. 文件大小限制
- 最大支持 10MB 的文件上传

### 3. 智能解析流程
1. **文本提取**：系统自动从上传的文档中提取文本内容
2. **AI 识别**：使用 AI 模型自动识别职位名称、公司名称和职位描述
3. **自动填充**：提取的信息自动填充到表单中
4. **人工确认**：用户可以在"手动输入/确认"标签页中检查和完善信息

## 技术实现

### 后端实现

#### 1. 文档解析服务 (`document_parser.py`)
- **位置**：`backend/app/services/document_parser.py`
- **功能**：
  - PDF 解析：使用 `pdfplumber` 库提取文本
  - Word 解析：使用 `python-docx` 库提取段落和表格文本
  - 自动识别文件类型并选择相应的解析方法

#### 2. API 接口 (`job.py`)
- **新增接口**：`POST /api/v1/jobs/analyze-document`
- **功能**：
  - 接收文件上传
  - 验证文件类型和大小
  - 调用文档解析服务提取文本
  - 使用 AI 服务识别职位信息
  - 返回结构化的职位数据

**接口详情**：
```python
@router.post("/analyze-document")
async def analyze_document(file: UploadFile = File(...)):
    """
    解析上传的职位文档（PDF 或 Word）并提取文本信息
    
    支持的文件格式：
    - PDF (.pdf)
    - Word (.doc, .docx)
    """
```

**返回数据格式**：
```json
{
  "title": "职位名称",
  "company": "公司名称",
  "description": "完整的职位描述文本",
  "parsed_data": {
    "job_title": "职位名称",
    "company": "公司名称",
    "location": "工作地点",
    "salary_range": "薪资范围",
    "requirements": {
      "education": "学历要求",
      "experience_years": "工作年限",
      "skills": ["技能1", "技能2"],
      "certifications": [],
      "other": []
    },
    "responsibilities": ["职责1", "职责2"],
    "benefits": ["福利1", "福利2"],
    "keywords": ["关键词1", "关键词2"]
  }
}
```

### 前端实现

#### 1. 新增标签页
- **位置**：`frontend/src/pages/jobs/JobInput.tsx`
- **标签名称**：文档上传解析
- **图标**：`FileTextOutlined`

#### 2. 核心功能
- **文件验证**：
  - 检查文件类型（仅允许 PDF 和 Word）
  - 检查文件大小（最大 10MB）
- **上传处理**：
  - 使用 `FormData` 上传文件
  - 显示加载状态（"AI 正在解析文档内容..."）
- **结果处理**：
  - 自动填充表单字段
  - 切换到"手动输入/确认"标签页
  - 显示成功或错误提示

#### 3. 用户体验优化
- 支持拖拽上传
- 实时反馈解析进度
- 清晰的错误提示
- 自动跳转到确认页面

## 使用流程

### 用户操作步骤

1. **进入录入页面**
   - 导航到"录入新职位"页面

2. **选择文档上传标签页**
   - 点击"文档上传解析"标签

3. **上传文档**
   - 方式一：点击上传区域选择文件
   - 方式二：拖拽文件到上传区域

4. **等待解析**
   - 系统显示"AI 正在解析文档内容..."
   - 解析通常需要 3-10 秒

5. **确认信息**
   - 系统自动跳转到"手动输入/确认"标签页
   - 检查提取的职位名称、公司名称和职位描述
   - 根据需要进行修改和完善

6. **提交录入**
   - 点击"提交录入进入解析"按钮
   - 系统进行深度 AI 解析

## 四种录入方式对比

| 方式 | 适用场景 | 优势 | 限制 |
|------|---------|------|------|
| **手动输入** | 信息已经是文本格式 | 最灵活，可直接粘贴 | 需要手动复制粘贴 |
| **网页链接同步** | 职位来自招聘网站 | 自动抓取，省时省力 | 需要有效的网页链接 |
| **截图识图分析** | 职位信息在图片中 | 支持粘贴，快速识别 | 需要清晰的截图 |
| **文档上传解析** | 职位信息在文档中 | 支持复杂格式，准确度高 | 需要上传文件 |

## 错误处理

### 常见错误及解决方案

1. **"不支持的文件类型"**
   - 原因：上传的文件不是 PDF 或 Word 格式
   - 解决：请上传 .pdf、.doc 或 .docx 格式的文件

2. **"文件大小超过限制"**
   - 原因：文件大于 10MB
   - 解决：压缩文件或选择较小的文件

3. **"文档解析失败，未能提取到文本内容"**
   - 原因：文档是扫描版或图片格式，无法提取文本
   - 解决：使用 OCR 工具转换后再上传，或使用截图识图功能

4. **"文档解析失败，请确保文件格式正确且包含职位信息"**
   - 原因：文件损坏或格式异常
   - 解决：检查文件是否正常打开，或重新导出文档

## 技术依赖

### 后端依赖
```
pdfplumber==0.10.3      # PDF 文本提取
python-docx==1.1.0      # Word 文档解析
python-multipart==0.0.6 # 文件上传支持
```

### 前端依赖
- Ant Design Upload 组件
- Axios（文件上传）

## 安全性考虑

1. **文件类型验证**：前后端双重验证文件类型
2. **文件大小限制**：防止过大文件占用服务器资源
3. **内容安全**：仅提取文本，不执行文档中的脚本或宏
4. **临时存储**：文件在内存中处理，不持久化保存

## 未来优化方向

1. **OCR 支持**：支持扫描版 PDF 的文字识别
2. **批量上传**：支持一次上传多个职位文档
3. **格式保留**：保留文档中的格式信息（如标题、列表等）
4. **更多格式**：支持 TXT、RTF 等其他文档格式
5. **预览功能**：上传前预览文档内容

## 注意事项

1. 确保上传的文档包含可提取的文本内容（非扫描版）
2. 文档内容越完整，AI 解析的准确度越高
3. 解析后请务必在确认页面检查提取的信息
4. 如果 AI 解析不准确，可以手动修改后再提交

## 相关文件

### 后端
- `backend/app/services/document_parser.py` - 文档解析服务
- `backend/app/api/v1/endpoints/job.py` - API 接口
- `backend/requirements.txt` - 依赖配置

### 前端
- `frontend/src/pages/jobs/JobInput.tsx` - 职位录入页面
- `frontend/src/pages/jobs/JobInput.css` - 样式文件
