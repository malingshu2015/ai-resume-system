# 职位文档上传功能 - 测试指南

## 测试前准备

### 1. 准备测试文档

准备以下类型的测试文档：

#### PDF 文档示例
创建一个包含以下内容的 PDF 文件（`test-job.pdf`）：
```
高级 Python 后端工程师

公司：某科技有限公司
地点：北京 · 朝阳区
薪资：25K-40K

职位描述：
我们正在寻找一位经验丰富的 Python 后端工程师加入我们的团队。

岗位职责：
1. 负责后端服务的设计、开发和维护
2. 参与系统架构设计和技术选型
3. 优化系统性能，提升用户体验

任职要求：
1. 本科及以上学历，计算机相关专业
2. 3年以上 Python 开发经验
3. 熟悉 FastAPI、Django 等 Web 框架
4. 熟悉 PostgreSQL、Redis 等数据库
5. 具有良好的代码规范和文档习惯
```

#### Word 文档示例
创建一个包含相同内容的 Word 文件（`test-job.docx`）

### 2. 启动应用

```bash
# 启动后端
cd backend
uvicorn app.main:app --reload

# 启动前端（新终端）
cd frontend
npm run dev
```

## 测试步骤

### 测试 1：基本文档上传（PDF）

1. **访问页面**
   - 打开浏览器访问 `http://localhost:5173`
   - 导航到"录入新职位"页面

2. **选择文档上传标签页**
   - 点击"文档上传解析"标签
   - 确认看到上传区域和提示信息

3. **上传 PDF 文档**
   - 点击上传区域，选择准备好的 `test-job.pdf`
   - 或者直接拖拽文件到上传区域

4. **验证解析过程**
   - 确认显示"AI 正在解析文档内容..."加载状态
   - 等待 3-10 秒

5. **验证结果**
   - 确认自动跳转到"手动输入/确认"标签页
   - 检查以下字段是否正确填充：
     - 职位名称：应包含"Python"、"后端"等关键词
     - 公司名称：应包含"科技"等关键词
     - 职位描述：应包含完整的 JD 文本
   - 显示成功提示："文档内容已提取，请检查并完善信息"

### 测试 2：基本文档上传（Word）

重复测试 1 的步骤，使用 Word 文档（`test-job.docx`）

### 测试 3：文件类型验证

1. **上传不支持的文件类型**
   - 尝试上传 `.txt`、`.jpg` 或其他非 PDF/Word 文件
   - **预期结果**：显示错误提示"仅支持 PDF 和 Word 文档格式"

### 测试 4：文件大小验证

1. **上传超大文件**
   - 创建或找一个大于 10MB 的 PDF 文件
   - 尝试上传
   - **预期结果**：显示错误提示"文件大小不能超过 10MB"

### 测试 5：空文档处理

1. **上传空白文档**
   - 创建一个空白的 PDF 或 Word 文档
   - 上传该文档
   - **预期结果**：显示错误提示"文档解析失败，未能提取到文本内容"

### 测试 6：扫描版 PDF

1. **上传扫描版 PDF**
   - 准备一个扫描版（图片格式）的 PDF 文件
   - 上传该文档
   - **预期结果**：
     - 可能显示错误提示"文档解析失败，未能提取到文本内容"
     - 或者提取到的内容为空

### 测试 7：复杂格式文档

1. **上传包含表格的文档**
   - 创建一个包含表格的 Word 文档，表格中包含职位信息
   - 上传该文档
   - **预期结果**：表格中的文本也应被正确提取

### 测试 8：完整流程测试

1. **上传文档**
   - 使用文档上传功能上传职位文档

2. **确认信息**
   - 在"手动输入/确认"页面检查并修改信息

3. **提交录入**
   - 点击"提交录入进入解析"按钮
   - 确认显示成功页面
   - 点击"返回职位库"查看新录入的职位

4. **验证后台解析**
   - 在职位库中找到刚录入的职位
   - 确认状态从"parsing"变为"parsed"
   - 查看职位详情，确认 AI 解析的结构化数据

## 后端 API 测试

### 使用 curl 测试

```bash
# 测试文档上传接口
curl -X POST http://localhost:8000/api/v1/jobs/analyze-document \
  -F "file=@/path/to/test-job.pdf" \
  -H "Content-Type: multipart/form-data"
```

### 预期响应

```json
{
  "title": "高级 Python 后端工程师",
  "company": "某科技有限公司",
  "description": "完整的职位描述文本...",
  "parsed_data": {
    "job_title": "高级 Python 后端工程师",
    "company": "某科技有限公司",
    "location": "北京 · 朝阳区",
    "salary_range": "25K-40K",
    "requirements": {
      "education": "本科及以上",
      "experience_years": "3年以上",
      "skills": ["Python", "FastAPI", "Django", "PostgreSQL", "Redis"],
      "certifications": [],
      "other": []
    },
    "responsibilities": [
      "负责后端服务的设计、开发和维护",
      "参与系统架构设计和技术选型",
      "优化系统性能，提升用户体验"
    ],
    "benefits": [],
    "keywords": ["Python", "后端", "FastAPI", "Django"]
  }
}
```

## 常见问题排查

### 问题 1：上传后一直显示加载状态

**可能原因**：
- 后端服务未启动
- AI 服务配置错误
- 网络连接问题

**排查步骤**：
1. 检查后端服务是否正常运行
2. 查看浏览器控制台的网络请求
3. 查看后端日志是否有错误信息

### 问题 2：提取的文本不完整

**可能原因**：
- PDF 是扫描版，无法提取文本
- 文档格式特殊，解析库不支持

**解决方案**：
- 使用 OCR 工具转换扫描版 PDF
- 尝试重新导出文档为标准格式
- 使用其他录入方式（如截图识图）

### 问题 3：AI 识别的职位信息不准确

**可能原因**：
- 文档格式不规范
- AI 模型理解偏差

**解决方案**：
- 在"手动输入/确认"页面手动修正
- 确保文档包含清晰的职位标题和公司名称

## 性能测试

### 测试不同大小的文档

| 文件大小 | 预期解析时间 |
|---------|------------|
| < 1MB   | 3-5 秒     |
| 1-5MB   | 5-8 秒     |
| 5-10MB  | 8-15 秒    |

### 并发测试

使用工具（如 Apache Bench）测试多个用户同时上传文档的情况：

```bash
# 安装 ab 工具后
ab -n 10 -c 2 -p test-job.pdf -T 'multipart/form-data' \
  http://localhost:8000/api/v1/jobs/analyze-document
```

## 测试检查清单

- [ ] PDF 文档上传成功
- [ ] Word 文档上传成功
- [ ] 文件类型验证正常
- [ ] 文件大小验证正常
- [ ] 空文档错误处理正常
- [ ] 文本提取准确
- [ ] AI 识别职位信息准确
- [ ] 自动填充表单正常
- [ ] 页面跳转正常
- [ ] 错误提示清晰友好
- [ ] 加载状态显示正常
- [ ] 完整流程可以走通
- [ ] 后台解析正常完成

## 测试报告模板

```
测试日期：____________________
测试人员：____________________

功能测试结果：
- PDF 上传：[ ] 通过  [ ] 失败  备注：__________
- Word 上传：[ ] 通过  [ ] 失败  备注：__________
- 文件验证：[ ] 通过  [ ] 失败  备注：__________
- 文本提取：[ ] 通过  [ ] 失败  备注：__________
- AI 识别：[ ] 通过  [ ] 失败  备注：__________
- 完整流程：[ ] 通过  [ ] 失败  备注：__________

发现的问题：
1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

改进建议：
1. _______________________________________________
2. _______________________________________________
3. _______________________________________________
```
